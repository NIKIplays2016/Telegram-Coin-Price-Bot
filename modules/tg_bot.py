import telebot
import datetime
import psycopg2
import json
from ..config import telegram_bot_token
from ..config import db_password


token= telegram_bot_token
bot=telebot.TeleBot(token)

connection = psycopg2.connect(
    dbname="userbase",
    user="postgres",
    password=db_password,#3-cr4td
    host="localhost"
)

def bot_write(id, sms):
    global bot
    try:
        bot.send_message(id,sms)
    except:
        print(f"bot was blocked by the {id}")


def get_sestings() -> dict:
    with open(R"base\settings.json") as file:
        settings = json.load(file)
    return settings

def save_settings(settings) -> None:
    with open(R"base\settings.json", "w", encoding="utf-8") as file:
        json.dump(settings, file, ensure_ascii=False)

def get_statick_info() -> dict:
    with open("base\static.json", "r") as file:
        token_base = json.load(file)
    return token_base

def save_statick_info(static) -> None:
    with open(R"base\statick.json", "w", encoding="utf-8") as file:
        json.dump(static, file, ensure_ascii=False)


####################################################

def update_user_data(user_base) -> None:
    user_id = user_base['id']
    cursor = connection.cursor()
    cursor.execute("SELECT * FROM users WHERE user_id=%s", (user_id,))
    existing_user = cursor.fetchone()

    if existing_user:
        user_list = [
            str(user_base['spam']['coins']), user_base['spam']['delay'], user_base['spam']['time'],
            str(user_base['warning']['coins']),str(user_base['warning']['limits']),
            user_base['action'], user_base["ban"]
            ]
        cursor.execute("UPDATE users SET spam_coins = %s, delay = %s, time = %s, warning_coins = %s, limits = %s, actions = %s, ban = %s WHERE user_id=%s", (*user_list, user_id,))
        connection.commit()
        cursor.close()
    else:
        cursor.close()
        raise ValueError("Not found user")

def update_user_local_data(user_id, field_name, new_field) -> None: 
    """Important! Observe the data type"""
    cursor = connection.cursor()
    cursor.execute("SELECT * FROM users WHERE user_id=%s", (user_id,))
    existing_user = cursor.fetchone()

    if existing_user:
        cursor.execute(f"UPDATE users SET {field_name} = %s WHERE user_id = %s", (new_field, user_id))
        connection.commit()
        cursor.close()
    else:
        cursor.close()
        raise ValueError("Not found user")


def get_user_dict(user_id) -> dict:
    cursor = connection.cursor()
    cursor.execute("SELECT * FROM users WHERE user_id=%s", (user_id,))
    user_data = cursor.fetchone()

    base = {}

    if user_data:
        base['id'] = user_data[0]
        base['name'] = user_data[1]
        base['root'] = user_data[2]

        base['spam'] = {}
        try:
            base['spam']['coins'] = eval(user_data[3])
        except:
            base['spam']['coins'] = []
        base['spam']['delay'] = user_data[4]
        base['spam']['time'] = user_data[5]

        base['warning'] = {}
        try:
            base['warning']['coins'] = eval(user_data[6])
        except:
            base['warning']['coins'] = []

        try:
            base['warning']['limits'] = eval(user_data[7])
        except:
            base['warning']['limits'] = []
        
        base['action'] = user_data[8]
        base['ban'] = user_data[9]
    else:
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å id {user_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")

    cursor.close()
    return base


def check_registrate(user_id) -> bool:
    cursor = connection.cursor()
    cursor.execute("SELECT * FROM users WHERE user_id=%s", (user_id,))
    user_data = cursor.fetchone()
    
    cursor.close()
    
    if user_data:
        return True
    else:
        return False


def check_ban(user_id) -> bool:
    cursor = connection.cursor()
    ban = cursor.execute("SELECT ban FROM users WHERE user_id=%s", (user_id,))
    cursor.close()
    return ban


def check_valid(message) -> bool:
    if not check_registrate(message.chat.id):
        bot.reply_to(message, "–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–º–∞–Ω–¥ –Ω—É–∂–Ω–æ –∑–∞—Ä–µ–≥–µ—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è. \n–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å.")
        return False
    elif check_ban(message.chat.id):
        bot.reply_to(message, f"–í—ã –±—ã–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã.üò¨ \n–ü–æ–¥–¥–µ—Ä–∂–∫–∞: @picard_off")
        return False
    else:
        return True
    
def check_admin(message):
    try:
        base = get_user_dict(message.from_user.id)
        if base["root"]:
            return True
        else:
            bot.reply_to(message, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")            
            return False
    except:
        bot.reply_to(message, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
        return False
        

#############################################

def registrate(message) -> None:
    cursor = connection.cursor()
    id = message.chat.id
    if id > 0:
        name = message.from_user.username
    elif id < 0:
        name = message.chat.title

    cursor.execute("INSERT INTO users(user_id, name, root, spam_coins, delay, time, warning_coins, limits, actions, ban, date_of_registration) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)", (id, name, False, "", 1, datetime.datetime.now(), "", "", 0, False, datetime.datetime.now()))
    connection.commit()
    cursor.close()

    bot.reply_to(message, text="Successful registration")


def bot_main() -> None:
    global bot
    settings = get_sestings()
    token_base = get_statick_info()

    """def check_admin(message, base) -> bool:

        try:
            chat_index = base["id"].index(message.chat.id)
        except:
            return False

        try:
            user_index = base["id"].index(message.from_user.id)
        except:
            return False

        if base["root"][chat_index] or base["root"][user_index]:
            return True
        else:
            return False"""


    #def reset_actions():
    #    return [False, False, False, False, False, False, False, False]


    @bot.message_handler(commands=['start'])
    def handle_start(message):
        id = message.chat.id
        
        if check_registrate(id):
            bot.reply_to(message, "–í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–æ–º–∞–Ω–¥–æ–π /help")
        else:
            bot.reply_to(message, "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å")
       



    @bot.message_handler(commands=['command1'])
    def handle_start(message):
        if not check_valid(message):
            return 0
        
        id = message.chat.id
        base = get_user_dict(id)

        keyboard1 = telebot.types.ReplyKeyboardMarkup(True, True)
        for i in token_base["tokens"]:
            keyboard1.row(i)

        bot.reply_to(message, "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã", reply_markup=keyboard1)
        update_user_local_data(id, "actions", 7)


    @bot.message_handler(commands=['command2'])
    def handle_start(message):
        if not check_valid(message):
            return 0
        
        id = message.chat.id
        base = get_user_dict(id)
        bot.reply_to(message, "–í–≤–µ–¥–∏—Ç–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑—ã–≤–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã –∏ –ø—Ä–µ–¥–µ–ª—ã. \n\n–ü—Ä–∏–º–µ—Ä: \TON 6.43 7.1")

        update_user_local_data(id, "actions", 1)


    @bot.message_handler(commands=['command3'])  # –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç—ã –∏–∑ warning
    def handle_start(message):
        if not check_valid(message):
            return 0
       
        id = message.chat.id
        base = get_user_dict(id)

        update_user_local_data(id, "actions", 6)
        bot.reply_to(message, "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã")


    @bot.message_handler(commands=['cooldown'])
    def handle_start(message):
        if not check_valid(message):
            return 0
       
        id = message.chat.id
        base = get_user_dict(id)

        update_user_local_data(id, "actions", 8)
        bot.reply_to(message, f"–í–≤–µ–¥–∏—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤ –º–∏–Ω—É—Ç–∞—Ö –º–µ–∂–¥—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–º–∏ \n–æ—Ç 1 –¥–æ 2880")


    @bot.message_handler(commands=['about_me'])
    def handle_start(message):
        if not check_valid(message):
            return 0
       
        id = message.chat.id
        base = get_user_dict(id)

        sms = f"id: {id}"

        sms += "\n\n–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ü–µ–Ω–µ:"
        sms += f"\n{base['spam']['coins']}"
        sms += f"\n –ü–µ—Ä–µ–æ–¥–∏—á–Ω–æ—Å—Ç—å: {base['spam']['delay']}–º"

        sms += "\n\n–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –º–æ–Ω–µ—Ç—ã –∏–∑ —Ü–µ–Ω–æ–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:\n"
        for i in range(len(base['warning']['coins'])):
            sms += f"\n–ú–æ–Ω–µ—Ç–∞: {base['warning']['coins'][i]} \n–¶–µ–Ω–æ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω: —Å {base['warning']['limits'][i][0]} –¥–æ {base['warning']['limits'][i][1]}\n"

        bot.reply_to(message, sms)


    @bot.message_handler(commands=['command0', "help", "info"])
    def handle_start(message):
        bot.reply_to(
            message,
            text=f""" 
'Coin price' - –≠—Ç–æ Telegram –±–æ—Ç –ø–æ–∑–≤–æ–ª—è—é—â–∏–π —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Ü–µ–Ω–æ–π —Ä–∞–∑–Ω—ã—Ö –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç.
v1.0 Beta

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ü–µ–Ω–µ –±–µ—Ä–µ—Ç—Å—è —Å okx.com

–ö–æ–º–∞–Ω–¥—ã:
 /command1 - –ü—Ä–∏ –≤–≤–æ–¥–µ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç –±—É–¥–µ—Ç –ø—Ä–∏—Å—ã–ª–∞—Ç—å –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É —Ü–µ–Ω—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å: /cooldown) –Ω–∞ –≤–≤–µ–¥–µ–Ω–Ω—É—é –≤–∞–º–∏ –º–æ–Ω–µ—Ç—É, —á—Ç–æ–±—ã –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–≤–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É.

 /command2 - –ü—Ä–∏ –≤–≤–æ–¥–µ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–∞–º –≤–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã, –≤–µ—Ä—Ö–Ω–∏–π –∏ –Ω–∏–∂–Ω–∏–π "–ø—Ä–µ–¥–µ–ª" —Ü–µ–Ω—ã. 
–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∏–∂–Ω–µ–≥–æ –∏–ª–∏ –≤–µ—Ä—Ö–Ω–µ–≥–æ –ø—Ä–µ–¥–µ–ª–∞ —Ü–µ–Ω—ã, –±–æ—Ç —É–≤–µ–¥–æ–º–∏—Ç –≤–∞—Å –æ–± —ç—Ç–æ–º. 

 /command3 - –ü—Ä–∏ –≤–≤–æ–¥–µ —ç—Ç–æ–π –∫–æ–º–º–∞–Ω–¥—ã –Ω—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã, –∏ –≤–∞–º –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ã—Ö–æ–¥–µ —Ü–µ–Ω—ã —ç—Ç–æ–π –º–∞–Ω–µ—Ç—ã –∏–∑ —Ü–µ–Ω–æ–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –≤—ã —É–∫–∞–∑–∞–ª–∏ —Ä–∞–Ω–µ–µ (/command2)  

 /cooldown - –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å –∫–∞–∫–æ–π —á–∞—Å—Ç–æ—Ç–æ–π –≤ –º–∏–Ω—É—Ç–∞—Ö, –±–æ—Ç –±—É–¥–µ—Ç –ø—Ä–∏—Å—ã–ª–∞—Ç—å –≤–∞–º —Ü–µ–Ω—É (–æ—Ç 1 –º–∏–Ω—É—Ç—ã –¥–æ 2880(2 –¥–Ω—è))

 /about_me - –ë–æ—Ç –≤—ã–≤–µ–¥–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—Å
 
@picard_off
19.05.2024
okx API 
               """
        )

    @bot.message_handler(commands=['id_list'])
    def handle_start(message):
        if not check_admin(message):
            return 0

        cursor = connection.cursor()
        cursor.execute("SELECT user_id, name FROM users")
        """
        rows = cursor.fetchall()
        cursor.close()
        
        indexes = rows[0]
        names = rows[1]

        sms = ""
        for i in range(len(indexes)):
            sms += f"\n {i}: {names[i]} - {indexes[i]}"
        """
        users = cursor.fetchall()

        sms = ""
        for i in range(len(users)):
            sms += f"\n {i}: {users[i][1]} - {users[i][0]}"
        cursor.close()

        bot.reply_to(message, sms)

    @bot.message_handler(commands=['admin'])
    def handle_start(message):
        if not check_admin(message):
            return 0

        bot.reply_to(message, "–ö–æ–º–∞–Ω–¥—ã –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: \n/id_list \n/ban \n/black_list \n\n–ö–æ–º–∞–Ω–¥—ã –≥–ª–∞–≤–Ω–æ–≥–æ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: \n/add_admin \n/delete_admin \n/change_main_admin ")


    @bot.message_handler(commands=["add_admin"])
    def handle_start(message):
        id = message.from_user.id

        sestings=get_sestings()

        if not id == sestings["main_admin"]:
            bot.reply_to(message, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã. –≠—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω")
            return 0

        update_user_local_data(id, "actions", 3)
        bot.reply_to(message, "–í–≤–µ–¥–∏—Ç–µ id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")


    @bot.message_handler(commands=["delete_admin"])
    def handle_start(message):
        id = message.from_user.id

        sestings=get_sestings()

        if not id == sestings["main_admin"]:
            bot.reply_to(message, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã. –≠—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω")
            return 0

        update_user_local_data(id, "actions", 4)
        bot.reply_to(message, "–í–≤–µ–¥–∏—Ç–µ id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")


    @bot.message_handler(commands=["change_main_admin"])
    def handle_start(message):
        id = message.from_user.id

        sestings=get_sestings()

        if not id == sestings["main_admin"]:
            bot.reply_to(message, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã. –≠—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω")
            return 0

        update_user_local_data(id, "actions", 5)
        bot.reply_to(message, "–í–≤–µ–¥–∏—Ç–µ id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")


    @bot.message_handler(commands=['ban'])
    def handle_start(message):
        id = message.from_user.id
        if not check_admin(message):
            return 0

        update_user_local_data(id, "actions", 2)
        bot.reply_to(message, "–í–≤–µ–¥–∏—Ç–µ id –∏ –¥–µ–π—Å—Ç–≤–∏–µ(0 - —É–±—Ä–∞—Ç—å –∏–∑ —á—Å, 1 - –¥–æ–±–∞–≤–∏—Ç—å –≤ —á—Å) \n\n–ü—Ä–∏–º–µ—Ä: \n1913991 1")




    @bot.message_handler(commands=['black_list'])
    def handle_start(message):
        id = message.from_user.id
        base = get_user_dict(id)

        if not check_admin(message):
            return 0

        cursor = connection.cursor()
        cursor.execute("SELECT user_id, name FROM users WHERE ban=%s", (True,))
        users = cursor.fetchall()
        cursor.close()

        if len(users) == 0:
            bot.reply_to(message, "–ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç")
        else:
            sms = ""
            for i in range(len(users)):
                try:
                    sms += f"\n {i}: {users[i][1]} - {users[i][0]}"
                except:
                    sms += f"\n {i}: Noname - {users[i][0]}"
            bot.reply_to(message, sms)






#######################################################################################################################
    @bot.message_handler(content_types=['text', 'document', 'audio', 'photo', 'video'])
    def get_text_messages(message):
        id = message.chat.id
        pid = message.from_user.id
        
        if not check_registrate(id):
            if message.text == settings['password']:
                registrate(message)
            else:
                bot.reply_to(message, text="–ù–µ –≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å")
                bot.send_message(id, "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∑–∞–Ω–æ–≤–æ")
            return 0

        base = get_user_dict(id)
        user_base = get_user_dict(pid)
        if base["ban"] and id > 0 and not user_base['root']:
            bot.reply_to(message, f"–í—ã –±—ã–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã.üò¨ \n–ü–æ–¥–¥–µ—Ä–∂–∫–∞: @picard_off")
            return 0
        elif base["ban"] and id < 0 and not user_base['root']:
            return 0


        if base['action'] == 1:
            try:
                command = message.text.split(" ")
                token, command[1], command[2] = command[0].upper(), float(command[1]), float(command[2])
            except:
                bot.reply_to(message, "‚ùå–ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥‚ùå \n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–Ω–æ–≤–æ –Ω–∞–∂–∞–≤ –Ω–∞ –∫–æ–º–∞–Ω–¥—É /command2")
                update_user_local_data(id, "actions", 0)
                return 0

            if not token in token_base["tokens"]:
                bot.reply_to(message, "–¢–∞–∫–æ–π –º–æ–Ω–µ—Ç—ã –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ")
                update_user_local_data(id, "actions", 0)
                return 0


            if token in base["warning"]["coins"]:
                token_index = base["warning"]["coins"].index(token)
                base["warning"]["limits"][token_index] = [command[1], command[2]]
            else:
                base["warning"]["coins"].append(token)
                base["warning"]["limits"].append([command[1], command[2]])
            
            bot.reply_to(message, f"–¢–µ–ø–µ—Ä—å –≤–∞–º –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ {token} \n–ü–æ–≤—ã—Å–∏—Ç—Å—è –¥–æ {command[2]}$ \n–£–ø–∞–¥–µ—Ç –¥–æ {command[1]}$")
            update_user_data(base)
            update_user_local_data(id, "actions", 0)


        elif user_base['action'] == 2:
            command = message.text.split(" ")
            try:
                command[0], command[1] = int(command[0]), int(command[1])
            except:
                bot.reply_to(message, "–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞")
                update_user_local_data(pid, "actions", 0)
                return 0

            try:
                if command[1] == 0:
                    update_user_local_data(command[0], "ban", False)
                    bot.reply_to(message, f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {command[0]} —Ç–µ–ø–µ—Ä—å –Ω–µ –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ")
                elif command[1] == 1:
                    update_user_local_data(command[0], "ban", True)
                    bot.reply_to(message, f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {command[0]} —Ç–µ–ø–µ—Ä—å –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ")
            except:
                bot.reply_to(message, "–¢–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç")

            update_user_local_data(pid, "actions", 0)

        elif  user_base['action'] == 3:
            try:
                nid = int(message.text)
            except:
                bot.reply_to(message, "–ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥")
                update_user_local_data(pid, "actions", 0)
                return 0

            try:
                update_user_local_data(nid, "root", True)
                bot.reply_to(message, f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {nid} —Ç–µ–ø–µ—Ä—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä")
            except:
                bot.reply_to(message, f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {nid} –Ω–µ –Ω–∞–π–¥–µ–Ω")
            update_user_local_data(pid, "actions", 0)
            


        elif  user_base['action'] == 4:
            try:
                nid = int(message.text)
            except:
                bot.reply_to(message, "–ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥")
                update_user_local_data(pid, "actions", 0)
                return 0

            try:
                update_user_local_data(pid, "actions", 0)
                update_user_local_data(nid, "root", False)
                bot.reply_to(message, f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {nid} —Ç–µ–ø–µ—Ä—å –Ω–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä")

            except:
                bot.reply_to(message, f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {nid} –Ω–µ –Ω–∞–π–¥–µ–Ω")

            update_user_local_data(pid, "actions", 0)


        elif  user_base['action'] == 5:
            try:
                nid = int(message.text)
            except:
                bot.reply_to(message, "–ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥")
                update_user_local_data(pid, "actions", 0)
                return 0

            bot.reply_to(message, f"–ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω –∏–∑–º–µ–Ω–µ–Ω —Å {base['main_admin']} –Ω–∞ {nid}")
            settings["main_admin"] = nid
            save_settings(settings)
            update_user_local_data(pid, "actions", 0)


        elif  base['action'] == 6: #–£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —Å warning
            token = message.text.upper()

            if token in base["warning"]["coins"]:
                token_index = base["warning"]["coins"].index(token)
                base["warning"]["coins"].remove(token)
                base["warning"]["limits"].pop(token_index)
                bot.reply_to(message, f"–¢–µ–ø–µ—Ä—å –≤–∞–º –Ω–µ –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ {token}")
            else:
                bot.reply_to(message, f"–£ –≤–∞—Å –Ω–µ —Å—Ç–æ–∏—Ç '–∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫' –Ω–∞ {token}")
            update_user_data(base)
            update_user_local_data(id, "actions", 0)
            

        elif  base['action'] == 7:
            sms = message.text.upper()
            if not sms in token_base["tokens"]:
                bot.reply_to(message, "–¢–∞–∫–æ–π –º–æ–Ω–µ—Ç—ã –∫ –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ")
                update_user_local_data(id, "actions", 0)
                return 0

            if sms in base["spam"]["coins"]:
                base["spam"]["coins"].remove(sms)
                bot.reply_to(message, f"–¢–µ–ø–µ—Ä—å –≤—ã –Ω–µ –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É —Ü–µ–Ω—ã –Ω–∞ {sms}")
            else:
                base["spam"]["coins"].append(sms)
                bot.reply_to(message, f"–¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É —Ü–µ–Ω—ã –Ω–∞ {sms}")
            update_user_data(base)
            update_user_local_data(id, "actions", 0)

        elif  base['action'] == 8:
            sms = message.text
            try:
                minutes = int(sms)
            except:
                bot.reply_to(message, f"–ù–µ –≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥: {sms} \n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–Ω–æ–≤–æ")
                update_user_local_data(id, "actions", 0)
                return 0

            if not (minutes >= 1 and minutes <= 2880):
                bot.reply_to(message, f"{minutes} –º–∏–Ω—É—Ç –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª 1-2880\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–Ω–æ–≤–æ")
                update_user_local_data(id, "actions", 0)
                return 0

            base['spam']['delay'] = minutes
            base['spam']['time'] = datetime.datetime.now()
            base['action'] = 0
            update_user_data(base)
            bot.reply_to(message, f"–¢–µ–ø–µ—Ä—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ü–µ–Ω–µ –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤–∞–º –∫–∞–∂–¥—ã–µ {minutes}–º")
            



    bot.polling(none_stop=True, interval=0)